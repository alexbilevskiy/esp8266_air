#include <SoftwareSerial.h>

#ifndef ESP8266_AIR_CO2_S18_H
#define ESP8266_AIR_CO2_S18_H

class Co2s18 {
public:
    bool debug = false;

    struct Co2result {
        int s1;
        int s2;
        int s3;
        int ppm;
        int temp;
        String abc;
        String cal;
    };

    Co2s18(int co2rxPin, int co2txPin);
    void init(bool debugEnabled);

    Co2result readCo2();

private:
    SoftwareSerial* co2Serial;

    //byte co2cmd[9] = {0xFF,0x01,0x86,0x00,0x00,0x00,0x00,0x00,0x79};
    //byte setABC[9] = {0xFF,0x01,0x79,0x00,0x00,0x00,0x00,0x00,0x86};
    //byte setRange[9] = {0xFF,0x01,0x99,0x00,0x00,0x00,0x13,0x88,0xCB};
    //byte co2cmd[7] = {0xFE,0x44,0x00,0x08,0x02,0x9F,0x25};
    byte co2cmd[8] = {0xFE,0x04,0x00,0x00,0x00,0x04,0xE5,0xC6};
    //byte co2cmd[8] = {0xFE,0x04,0x00,0x00,0x00,0x05,0x24,0x06};
    byte abcCmd[8] = {0xFE,0x03,0x00,0x1F,0x00,0x01,0xA1,0xC3};
    byte calCmd[8] = {0xFE,0x03,0x00,0x00,0x00,0x01,0x90,0x05};

    int co2NextCheck = 0;

    bool sendCo2(byte *cmd, int cmdLen, byte *response, int len);
    String readOne(byte *cmd);

    Co2result cachedResult;
};


#endif //ESP8266_AIR_CO2_S18_H
